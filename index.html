<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ö–ª–∏–∫–µ—Ä —Å –ö–∞–ø–∏–±–∞—Ä–æ–π üêæ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          keyframes: {
            pulseBoost: { 
              '0%,100%': { opacity: 1, boxShadow: '0 0 20px #60a5fa' }, 
              '50%': { opacity: 0.8, boxShadow: '0 0 40px #3b82f6' } 
            },
            float: { 
              '0%,100%': { transform: 'translateY(0)' }, 
              '50%': { transform: 'translateY(-8px)' } 
            },
            shake: {
              '0%,100%': { transform: 'translateX(0)' },
              '25%': { transform: 'translateX(-5px)' },
              '75%': { transform: 'translateX(5px)' }
            },
            bounceIn: {
              '0%': { transform: 'scale(0)', opacity: 0 },
              '50%': { transform: 'scale(1.1)' },
              '100%': { transform: 'scale(1)', opacity: 1 }
            },
            glow: {
              '0%,100%': { filter: 'drop-shadow(0 0 5px rgba(255,215,0,0.5))' },
              '50%': { filter: 'drop-shadow(0 0 20px rgba(255,215,0,0.8))' }
            }
          },
          animation: {
            pulseBoost: 'pulseBoost 1s infinite',
            float: 'float 3s ease-in-out infinite',
            shake: 'shake 0.3s ease-in-out',
            bounceIn: 'bounceIn 0.5s ease-out',
            glow: 'glow 2s ease-in-out infinite'
          }
        }
      }
    }
  </script>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Poppins', sans-serif;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .capybara-btn {
      border-radius: 50%;
      object-fit: contain;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      transition: transform 0.15s ease, filter 0.3s ease;
      cursor: pointer;
      user-select: none;
      -webkit-user-drag: none;
    }
    .particle {
      position: absolute;
      pointer-events: none;
      font-weight: bold;
      font-size: 1.5rem;
      animation: particleFloat 1s ease-out forwards;
      z-index: 1000;
    }
    @keyframes particleFloat {
      0% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
      100% {
        opacity: 0;
        transform: translateY(-80px) scale(1.2);
      }
    }
    .combo-indicator {
      animation: bounceIn 0.3s ease-out;
    }
    .progress-bar {
      transition: width 0.3s ease-out;
    }
    .stat-card {
      backdrop-filter: blur(10px);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    @media (max-width: 640px) {
      .capybara-btn {
        max-width: 120px;
        max-height: 120px;
      }
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-sky-500 via-emerald-500 to-teal-600 p-3 sm:p-4 pt-4 sm:pt-6 text-white">

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
  <div class="max-w-7xl mx-auto">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="text-center mb-4 sm:mb-6">
      <h1 class="text-3xl sm:text-4xl font-black mb-2 bg-clip-text text-transparent bg-gradient-to-r from-yellow-300 via-orange-400 to-pink-400">
        üêæ –ö–ª–∏–∫–µ—Ä —Å –ö–∞–ø–∏–±–∞—Ä–æ–π üêæ
      </h1>
      <div id="greeting" class="text-lg sm:text-xl font-semibold mb-2"></div>
      <div id="comboIndicator" class="hidden text-2xl font-bold text-yellow-300 combo-indicator mb-2">
        üî• –ö–æ–º–±–æ x<span id="comboMultiplier">1</span>!
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">
      
      <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å: –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–∞ -->
      <div class="lg:col-span-2 space-y-4 sm:space-y-6">
        <!-- –°—á–µ—Ç –∏ —É—Ä–æ–≤–µ–Ω—å -->
        <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-4 sm:p-6 border border-white/20 stat-card">
          <div class="text-center">
            <div class="flex items-center justify-center gap-3 mb-2">
              <div id="score" class="text-4xl sm:text-5xl md:text-6xl font-black bg-clip-text text-transparent bg-gradient-to-r from-amber-300 to-orange-500">
                0
              </div>
              <div id="levelBadge" class="px-3 py-1 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full text-sm sm:text-base font-bold">
                Lv. <span id="level">1</span>
              </div>
            </div>
            <div id="levelProgressContainer" class="mt-3 h-2 w-full max-w-xs mx-auto rounded-full bg-white/20">
              <div id="levelProgress" class="h-full rounded-full bg-gradient-to-r from-purple-500 to-pink-500 progress-bar" style="width: 0%"></div>
            </div>
            <div id="boostIndicator" class="mt-3 h-2 w-full max-w-xs mx-auto rounded-full bg-white/30 hidden">
              <div id="boostBar" class="h-full rounded-full bg-gradient-to-r from-cyan-300 to-blue-400 progress-bar" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <!-- –ö–∞–ø–∏–±–∞—Ä–∞ –¥–ª—è –∫–ª–∏–∫–∞ -->
        <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 sm:p-8 border border-white/20 stat-card text-center">
          <div class="relative flex justify-center items-center mb-4">
            <div id="particleContainer" class="absolute inset-0 pointer-events-none"></div>
            <img 
              id="capybaraBtn"
              src="https://static.vecteezy.com/system/resources/previews/057/531/498/large_2x/a-detailed-image-of-a-capybara-shows-its-fur-and-features-isolated-on-transparent-background-free-png.png"
              alt="–ö–ª–∏–∫–∞–π –ø–æ –∫–∞–ø–∏–±–∞—Ä–µ!"
              class="capybara-btn w-32 h-32 sm:w-40 sm:h-40 md:w-44 md:h-44 animate-float"
            />
          </div>
          <div class="text-sm sm:text-base text-white/80">
            <div>–û—á–∫–æ–≤ –∑–∞ –∫–ª–∏–∫: <span id="pointsPerClick" class="font-bold text-amber-300">1</span></div>
            <div class="mt-1">–ê–≤—Ç–æ–∫–ª–∏–∫: <span id="autoClickRate" class="font-bold text-green-300">0</span> –æ—á–∫–æ–≤/—Å–µ–∫</div>
          </div>
        </div>

        <!-- –£–ª—É—á—à–µ–Ω–∏—è -->
        <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-4 sm:p-5 border border-white/20">
          <h3 class="text-lg sm:text-xl font-bold mb-3 sm:mb-4 flex items-center gap-2">
            ‚ö° –£–ª—É—á—à–µ–Ω–∏—è
          </h3>
          <div id="upgrades" class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <!-- –£–ª—É—á—à–µ–Ω–∏—è –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
          </div>
        </div>

        <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
        <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-4 sm:p-5 border border-white/20">
          <h3 class="text-lg sm:text-xl font-bold mb-3 sm:mb-4 flex items-center gap-2">
            üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
          </h3>
          <div id="achievements" class="grid grid-cols-2 sm:grid-cols-3 gap-3 text-xs sm:text-sm"></div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
        <div class="flex flex-col sm:flex-row gap-3">
          <button id="boostBtn"
            class="flex-1 py-3 px-4 bg-gradient-to-r from-amber-500 to-orange-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl opacity-60 cursor-not-allowed text-sm sm:text-base transition-all duration-200">
            ‚ö° –ë—É—Å—Ç x2 ‚Äî 50 –æ—á–∫–æ–≤
          </button>
          <button id="exportBtn"
            class="flex-1 py-3 px-4 bg-white/20 hover:bg-white/30 text-white font-medium rounded-xl transition-all duration-200 text-sm sm:text-base">
            üì• –°–∫–∞—á–∞—Ç—å –æ—Ç—á—ë—Ç
          </button>
        </div>
      </div>

      <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –¢–æ–ø -->
      <div class="space-y-4 sm:space-y-6">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-4 sm:p-5 border border-white/20 stat-card">
          <h3 class="text-lg sm:text-xl font-bold mb-3 sm:mb-4 text-center">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
          <div class="space-y-2 sm:space-y-3 text-sm sm:text-base">
            <div class="flex justify-between items-center">
              <span class="text-white/80">–í—Å–µ–≥–æ –∫–ª–∏–∫–æ–≤:</span>
              <span id="totalClicks" class="font-bold text-amber-300">0</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-white/80">–ú–∞–∫—Å. –∫–æ–º–±–æ:</span>
              <span id="maxCombo" class="font-bold text-purple-300">0</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-white/80">–í—Ä–µ–º—è –∏–≥—Ä—ã:</span>
              <span id="playTime" class="font-bold text-green-300">0:00</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-white/80">–ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–æ–≤:</span>
              <span id="autoClickersCount" class="font-bold text-blue-300">0</span>
            </div>
          </div>
        </div>

        <!-- –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤ -->
        <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-4 sm:p-5 border border-white/20 stat-card">
          <h3 class="text-lg sm:text-xl font-bold mb-3 sm:mb-4 text-center">üèÖ –¢–æ–ø-5 –∏–≥—Ä–æ–∫–æ–≤</h3>
          <div id="leaderboard" class="space-y-2 sm:space-y-3">
            <!-- –¢–æ–ø –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
          </div>
          <p class="text-xs text-white/60 mt-3 sm:mt-4 text-center">–¢–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const DATA_KEY = "capybaraClickerData";
    const LEADERBOARD_KEY = "capybaraLeaderboard";

    const ACHIEVEMENTS = [
      { id: '10', points: 10, title: "–ü–µ—Ä–≤—ã–π –∫–ª–∏–∫", emoji: "üêæ" },
      { id: '25', points: 25, title: "–î—Ä—É–≥ –∫–∞–ø–∏–±–∞—Ä", emoji: "ü¶ù" },
      { id: '50', points: 50, title: "–ë—É—Å—Ç-–º–µ–π—Å—Ç–µ—Ä", emoji: "‚ö°" },
      { id: '100', points: 100, title: "–ö–∞–ø–∏–±–∞-–ª–µ–≥–µ–Ω–¥–∞", emoji: "üëë" },
      { id: '200', points: 200, title: "–¶–∞—Ä—å –±–æ–ª–æ—Ç–∞", emoji: "üåø" },
      { id: '500', points: 500, title: "–ú–∞—Å—Ç–µ—Ä –∫–ª–∏–∫–æ–≤", emoji: "üíé" },
      { id: '1000', points: 1000, title: "–õ–µ–≥–µ–Ω–¥–∞ –∫–ª–∏–∫–µ—Ä–∞", emoji: "üåü" }
    ];

    const UPGRADES = [
      { id: 'clickPower', name: "–°–∏–ª–∞ –∫–ª–∏–∫–∞", emoji: "üí™", baseCost: 10, costMultiplier: 1.5, description: "+1 –æ—á–∫–æ –∑–∞ –∫–ª–∏–∫" },
      { id: 'autoClicker1', name: "–ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä I", emoji: "ü§ñ", baseCost: 50, costMultiplier: 2, description: "+1 –æ—á–∫–æ/—Å–µ–∫" },
      { id: 'autoClicker2', name: "–ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä II", emoji: "‚öôÔ∏è", baseCost: 200, costMultiplier: 2.5, description: "+5 –æ—á–∫–æ–≤/—Å–µ–∫" },
      { id: 'autoClicker3', name: "–ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä III", emoji: "üöÄ", baseCost: 1000, costMultiplier: 3, description: "+25 –æ—á–∫–æ–≤/—Å–µ–∫" }
    ];

    const SIZES = [64, 80, 96, 112, 128, 144, 160, 176];

    let state = {
      playerName: "",
      score: 0,
      level: 1,
      levelProgress: 0,
      boostActive: false,
      boostEndTime: 0,
      unlockedAchievements: new Set(),
      upgrades: {
        clickPower: 0,
        autoClicker1: 0,
        autoClicker2: 0,
        autoClicker3: 0
      },
      totalClicks: 0,
      maxCombo: 0,
      currentCombo: 0,
      comboTimeout: null,
      comboEndTime: 0,
      playTime: 0,
      startTime: Date.now(),
      lastSaveTime: Date.now()
    };

    // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
    const greetingEl = document.getElementById('greeting');
    const scoreEl = document.getElementById('score');
    const levelEl = document.getElementById('level');
    const levelBadgeEl = document.getElementById('levelBadge');
    const levelProgressEl = document.getElementById('levelProgress');
    const levelProgressContainerEl = document.getElementById('levelProgressContainer');
    const pointsPerClickEl = document.getElementById('pointsPerClick');
    const autoClickRateEl = document.getElementById('autoClickRate');
    const capybaraBtn = document.getElementById('capybaraBtn');
    const boostBtn = document.getElementById('boostBtn');
    const exportBtn = document.getElementById('exportBtn');
    const boostIndicator = document.getElementById('boostIndicator');
    const boostBar = document.getElementById('boostBar');
    const achievementsEl = document.getElementById('achievements');
    const leaderboardEl = document.getElementById('leaderboard');
    const upgradesEl = document.getElementById('upgrades');
    const comboIndicatorEl = document.getElementById('comboIndicator');
    const comboMultiplierEl = document.getElementById('comboMultiplier');
    const totalClicksEl = document.getElementById('totalClicks');
    const maxComboEl = document.getElementById('maxCombo');
    const playTimeEl = document.getElementById('playTime');
    const autoClickersCountEl = document.getElementById('autoClickersCount');
    const particleContainerEl = document.getElementById('particleContainer');

    // === –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ ===
    function saveGameState() {
      try {
        const now = Date.now();
        state.playTime += (now - state.lastSaveTime) / 1000;
        state.lastSaveTime = now;
        
        localStorage.setItem(DATA_KEY, JSON.stringify({
          playerName: state.playerName,
          score: state.score,
          level: state.level,
          levelProgress: state.levelProgress,
          boostActive: state.boostActive,
          boostEndTime: state.boostEndTime,
          unlockedAchievements: [...state.unlockedAchievements],
          upgrades: state.upgrades,
          totalClicks: state.totalClicks,
          maxCombo: state.maxCombo,
          playTime: state.playTime,
          startTime: state.startTime
        }));
      } catch (e) { 
        console.warn("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", e); 
      }
    }

    function loadGameState() {
      try {
        const data = JSON.parse(localStorage.getItem(DATA_KEY) || '{}');
        const now = Date.now();
        state.playerName = data.playerName || "";
        state.score = data.score || 0;
        state.level = data.level || 1;
        state.levelProgress = data.levelProgress || 0;
        state.boostActive = data.boostActive || false;
        state.boostEndTime = data.boostEndTime || 0;
        state.unlockedAchievements = new Set(data.unlockedAchievements || []);
        state.upgrades = data.upgrades || {
          clickPower: 0,
          autoClicker1: 0,
          autoClicker2: 0,
          autoClicker3: 0
        };
        state.totalClicks = data.totalClicks || 0;
        state.maxCombo = data.maxCombo || 0;
        state.playTime = data.playTime || 0;
        state.startTime = data.startTime || now;
        state.lastSaveTime = now;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏—Å—Ç–µ–∫ –ª–∏ –±—É—Å—Ç
        if (state.boostActive && state.boostEndTime && now >= state.boostEndTime) {
          state.boostActive = false;
          state.boostEndTime = 0;
        }
      } catch (e) { 
        console.warn("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", e); 
      }
    }

    function getLeaderboard() {
      try {
        return JSON.parse(localStorage.getItem(LEADERBOARD_KEY) || '[]');
      } catch (e) {
        console.warn("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞:", e);
        return [];
      }
    }

    function saveToLeaderboard() {
      if (!state.playerName) return;
      try {
        const leaderboard = getLeaderboard();
        const existing = leaderboard.find(item => item.name === state.playerName);
        
        if (existing) {
          if (state.score > existing.score) {
            existing.score = state.score;
            existing.date = new Date().toISOString();
          }
        } else {
          leaderboard.push({
            name: state.playerName,
            score: state.score,
            date: new Date().toISOString()
          });
        }

        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é –∏ –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ø-5
        leaderboard.sort((a, b) => b.score - a.score);
        const top5 = leaderboard.slice(0, 5);
        localStorage.setItem(LEADERBOARD_KEY, JSON.stringify(top5));
        renderLeaderboard();
      } catch (e) {
        console.warn("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥:", e);
      }
    }

    function renderLeaderboard() {
      const leaderboard = getLeaderboard();
      leaderboardEl.innerHTML = '';
      
      if (leaderboard.length === 0) {
        leaderboardEl.innerHTML = '<p class="text-center text-white/70 text-sm">–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∫–æ—Ä–¥–æ–≤</p>';
        return;
      }

      leaderboard.forEach((item, index) => {
        const isCurrent = item.name === state.playerName;
        const medal = ['ü•á', 'ü•à', 'ü•â', '4Ô∏è‚É£', '5Ô∏è‚É£'][index] || 'üèÜ';
        const div = document.createElement('div');
        div.className = `p-2 sm:p-3 rounded-lg flex justify-between items-center text-sm ${
          isCurrent ? 'bg-amber-500/20 border border-amber-400/50' : 'bg-white/10'
        }`;
        div.innerHTML = `
          <div class="font-medium truncate">${medal} ${item.name}</div>
          <div class="font-bold text-amber-300 ml-2">${item.score}</div>
        `;
        leaderboardEl.appendChild(div);
      });
    }

    // === –°–∏—Å—Ç–µ–º–∞ —É—Ä–æ–≤–Ω–µ–π ===
    function calculateLevel() {
      const baseXP = 100;
      let newLevel = 1;
      let totalXPNeeded = 0;
      
      // –í—ã—á–∏—Å–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—â–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
      while (state.levelProgress >= totalXPNeeded + baseXP * Math.pow(1.5, newLevel - 1)) {
        totalXPNeeded += baseXP * Math.pow(1.5, newLevel - 1);
        newLevel++;
      }
      
      if (newLevel > state.level) {
        state.level = newLevel;
        showLevelUpAnimation();
      }
      
      // –†–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
      let prevLevelTotalXP = 0;
      for (let i = 1; i < state.level; i++) {
        prevLevelTotalXP += baseXP * Math.pow(1.5, i - 1);
      }
      
      const currentLevelXP = baseXP * Math.pow(1.5, state.level - 1);
      const progressInLevel = state.levelProgress - prevLevelTotalXP;
      const progressPercent = Math.max(0, Math.min((progressInLevel / currentLevelXP) * 100, 100));
      
      levelProgressEl.style.width = progressPercent + '%';
    }

    function showLevelUpAnimation() {
      levelBadgeEl.classList.add('animate-glow');
      setTimeout(() => levelBadgeEl.classList.remove('animate-glow'), 2000);
    }

    // === –≠—Ñ—Ñ–µ–∫—Ç—ã —á–∞—Å—Ç–∏—Ü ===
    function createParticle(x, y, points) {
      const particle = document.createElement('div');
      particle.className = 'particle';
      particle.textContent = `+${points}`;
      particle.style.left = x + 'px';
      particle.style.top = y + 'px';
      particle.style.color = state.boostActive ? '#60a5fa' : '#fbbf24';
      particleContainerEl.appendChild(particle);
      
      setTimeout(() => {
        if (particle.parentNode) {
          particle.parentNode.removeChild(particle);
        }
      }, 1000);
    }

    // === –ö–æ–º–±–æ-—Å–∏—Å—Ç–µ–º–∞ ===
    function updateCombo() {
      const now = Date.now();
      if (now - state.comboEndTime > 2000) {
        state.currentCombo = 0;
        comboIndicatorEl.classList.add('hidden');
      }
      
      state.currentCombo++;
      if (state.currentCombo > state.maxCombo) {
        state.maxCombo = state.currentCombo;
      }
      
      state.comboEndTime = now;
      
      if (state.currentCombo >= 5) {
        comboIndicatorEl.classList.remove('hidden');
        const multiplier = Math.min(Math.floor(state.currentCombo / 5), 5);
        comboMultiplierEl.textContent = multiplier;
      }
      
      if (state.comboTimeout) {
        clearTimeout(state.comboTimeout);
      }
      
      state.comboTimeout = setTimeout(() => {
        state.currentCombo = 0;
        comboIndicatorEl.classList.add('hidden');
      }, 2000);
    }

    function getComboMultiplier() {
      if (state.currentCombo < 5) return 1;
      return Math.min(Math.floor(state.currentCombo / 5), 5);
    }

    // === –ò–º—è –∏–≥—Ä–æ–∫–∞ ===
    function askForName() {
      if (state.playerName) return;
      let name = prompt("üëã –ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?", "–ò–≥—Ä–æ–∫");
      if (!name || name.trim() === "") name = "–ê–Ω–æ–Ω–∏–º";
      state.playerName = name.trim();
      saveGameState();
      updateUI();
      renderLeaderboard();
    }

    // === –†–∞—Å—á–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–π ===
    function getPointsPerClick() {
      return 1 + state.upgrades.clickPower;
    }

    function getAutoClickRate() {
      return state.upgrades.autoClicker1 * 1 + 
             state.upgrades.autoClicker2 * 5 + 
             state.upgrades.autoClicker3 * 25;
    }

    function getUpgradeCost(upgradeId) {
      const upgrade = UPGRADES.find(u => u.id === upgradeId);
      if (!upgrade) return Infinity;
      const level = state.upgrades[upgradeId] || 0;
      return Math.floor(upgrade.baseCost * Math.pow(upgrade.costMultiplier, level));
    }

    // === UI ===
    function updateUI() {
      greetingEl.textContent = state.playerName ? `–ü—Ä–∏–≤–µ—Ç, ${state.playerName}!` : "";
      scoreEl.textContent = state.score.toLocaleString('ru-RU');
      levelEl.textContent = state.level;
      pointsPerClickEl.textContent = getPointsPerClick();
      autoClickRateEl.textContent = getAutoClickRate();
      totalClicksEl.textContent = state.totalClicks.toLocaleString('ru-RU');
      maxComboEl.textContent = state.maxCombo;
      
      const autoClickersTotal = state.upgrades.autoClicker1 + state.upgrades.autoClicker2 + state.upgrades.autoClicker3;
      autoClickersCountEl.textContent = autoClickersTotal;

      // –†–∞–∑–º–µ—Ä –∫–∞–ø–∏–±–∞—Ä—ã
      const sizeIndex = Math.min(Math.floor(state.level / 2), SIZES.length - 1);
      const size = SIZES[sizeIndex];
      capybaraBtn.style.width = `${size}px`;
      capybaraBtn.style.height = `${size}px`;

      // –ü—Ä–æ–≥—Ä–µ—Å—Å —É—Ä–æ–≤–Ω—è
      calculateLevel();

      // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
      achievementsEl.innerHTML = '';
      ACHIEVEMENTS.forEach(ach => {
        const unlocked = state.unlockedAchievements.has(ach.id);
        const el = document.createElement('div');
        el.className = `p-2 sm:p-3 rounded-lg text-center ${unlocked ? 'bg-amber-500/20 border border-amber-400/50' : 'bg-white/10'}`;
        el.innerHTML = `
          <div class="text-xl sm:text-2xl mb-1">${unlocked ? ach.emoji : 'üîí'}</div>
          <div class="font-medium text-xs sm:text-sm">${ach.title}</div>
          <div class="opacity-80 text-xs mt-1">${unlocked ? '‚úÖ' : ach.points}</div>
        `;
        achievementsEl.appendChild(el);
      });

      // –£–ª—É—á—à–µ–Ω–∏—è
      upgradesEl.innerHTML = '';
      UPGRADES.forEach(upgrade => {
        const level = state.upgrades[upgrade.id] || 0;
        const cost = getUpgradeCost(upgrade.id);
        const canAfford = state.score >= cost;
        
        const el = document.createElement('button');
        el.className = `p-3 sm:p-4 rounded-xl text-left transition-all duration-200 ${
          canAfford 
            ? 'bg-white/10 hover:bg-white/20 border border-white/20 hover:border-white/40 cursor-pointer' 
            : 'bg-white/5 border border-white/10 opacity-60 cursor-not-allowed'
        }`;
        el.disabled = !canAfford;
        el.innerHTML = `
          <div class="flex items-center justify-between mb-2">
            <div class="text-lg sm:text-xl">${upgrade.emoji}</div>
            <div class="text-xs sm:text-sm font-semibold text-amber-300">–£—Ä. ${level}</div>
          </div>
          <div class="font-semibold text-sm sm:text-base mb-1">${upgrade.name}</div>
          <div class="text-xs text-white/70 mb-2">${upgrade.description}</div>
          <div class="text-sm font-bold text-green-300">${cost.toLocaleString('ru-RU')} –æ—á–∫–æ–≤</div>
        `;
        el.onclick = () => buyUpgrade(upgrade.id);
        upgradesEl.appendChild(el);
      });

      // –ë—É—Å—Ç
      const canBoost = state.score >= 50 && !state.boostActive;
      boostBtn.disabled = !canBoost;
      boostBtn.className = `flex-1 py-3 px-4 text-white font-semibold rounded-xl shadow-lg text-sm sm:text-base transition-all duration-200 ${
        canBoost 
          ? 'bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-400 hover:to-orange-500 hover:shadow-xl cursor-pointer opacity-100' 
          : 'bg-gradient-to-r from-amber-500 to-orange-600 opacity-60 cursor-not-allowed'
      }`;
    }

    // === –ü–æ–∫—É–ø–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π ===
    function buyUpgrade(upgradeId) {
      const cost = getUpgradeCost(upgradeId);
      if (state.score < cost) return;
      
      state.score -= cost;
      state.upgrades[upgradeId] = (state.upgrades[upgradeId] || 0) + 1;
      
      updateUI();
      saveGameState();
    }

    // === –ë—É—Å—Ç ===
    function activateBoost() {
      if (state.score < 50 || state.boostActive) return;
      state.score -= 50;
      state.boostActive = true;
      state.boostEndTime = Date.now() + 10000;
      boostIndicator.classList.remove('hidden');
      boostBar.style.width = '100%';
      capybaraBtn.style.filter = 'brightness(1.2) drop-shadow(0 0 20px #60a5fa)';
      updateUI();
      startBoostTimer();
      saveGameState();
    }

    function startBoostTimer() {
      const tick = () => {
        const now = Date.now();
        if (now >= state.boostEndTime) {
          state.boostActive = false;
          boostIndicator.classList.add('hidden');
          capybaraBtn.style.filter = '';
          updateUI();
          saveGameState();
          return;
        }
        const progress = (state.boostEndTime - now) / 10000;
        boostBar.style.width = `${progress * 100}%`;
        setTimeout(tick, 100);
      };
      tick();
    }

    // === –ö–ª–∏–∫ ===
    function handleClick(event) {
      // –ê–Ω–∏–º–∞—Ü–∏—è –∫–ª–∏–∫–∞
      capybaraBtn.style.transform = 'scale(0.92)';
      setTimeout(() => capybaraBtn.style.transform = '', 150);

      // –†–∞—Å—á–µ—Ç –æ—á–∫–æ–≤
      const basePoints = getPointsPerClick();
      const boostMultiplier = state.boostActive ? 2 : 1;
      const comboMultiplier = getComboMultiplier();
      const totalPoints = Math.floor(basePoints * boostMultiplier * comboMultiplier);

      // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—á–∫–æ–≤
      state.score += totalPoints;
      state.totalClicks++;
      state.levelProgress += totalPoints;

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–±–æ
      updateCombo();

      // –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Å—Ç–∏—Ü—ã
      const rect = capybaraBtn.getBoundingClientRect();
      const x = rect.left + rect.width / 2 + (Math.random() - 0.5) * 40;
      const y = rect.top + rect.height / 2 + (Math.random() - 0.5) * 40;
      createParticle(x, y, totalPoints);

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
      ACHIEVEMENTS.forEach(ach => {
        if (state.score >= ach.points && !state.unlockedAchievements.has(ach.id)) {
          state.unlockedAchievements.add(ach.id);
          showAchievementNotification(ach);
        }
      });

      updateUI();
      saveGameState();
      
      // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥ —Ä–µ–∂–µ (–∫–∞–∂–¥—ã–µ 10 –∫–ª–∏–∫–æ–≤)
      if (state.totalClicks % 10 === 0) {
        saveToLeaderboard();
      }
    }

    function showAchievementNotification(achievement) {
      const notification = document.createElement('div');
      notification.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-gradient-to-r from-amber-500 to-orange-600 text-white px-6 py-3 rounded-xl shadow-2xl z-50 animate-bounceIn';
      notification.innerHTML = `
        <div class="text-center">
          <div class="text-3xl mb-1">${achievement.emoji}</div>
          <div class="font-bold text-lg">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ!</div>
          <div class="text-sm opacity-90">${achievement.title}</div>
        </div>
      `;
      document.body.appendChild(notification);
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transition = 'opacity 0.5s';
        setTimeout(() => document.body.removeChild(notification), 500);
      }, 3000);
    }

    // === –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä ===
    function startAutoClicker() {
      setInterval(() => {
        const rate = getAutoClickRate();
        if (rate > 0) {
          const basePoints = getPointsPerClick();
          const boostMultiplier = state.boostActive ? 2 : 1;
          const points = Math.floor(basePoints * rate * boostMultiplier);
          
          if (points > 0) {
            state.score += points;
            state.levelProgress += points;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
            ACHIEVEMENTS.forEach(ach => {
              if (state.score >= ach.points && !state.unlockedAchievements.has(ach.id)) {
                state.unlockedAchievements.add(ach.id);
              }
            });
            
            updateUI();
          }
        }
      }, 1000);
    }

    // === –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏–≥—Ä—ã ===
    function updatePlayTime() {
      const now = Date.now();
      state.playTime += (now - state.lastSaveTime) / 1000;
      state.lastSaveTime = now;
      
      const minutes = Math.floor(state.playTime / 60);
      const seconds = Math.floor(state.playTime % 60);
      playTimeEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
      
      setTimeout(updatePlayTime, 1000);
    }

    // === –≠–∫—Å–ø–æ—Ä—Ç ===
    function exportToTxt() {
      const date = new Date().toLocaleString('ru-RU');
      const minutes = Math.floor(state.playTime / 60);
      const seconds = Math.floor(state.playTime % 60);
      
      let content = `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n`;
      content += `    –û–¢–ß–Å–¢ –ò–ì–†–û–ö–ê "${state.playerName}"\n`;
      content += `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n`;
      content += `üìÖ –î–∞—Ç–∞: ${date}\n`;
      content += `üíØ –û—á–∫–∏: ${state.score.toLocaleString('ru-RU')}\n`;
      content += `‚≠ê –£—Ä–æ–≤–µ–Ω—å: ${state.level}\n`;
      content += `‚ö° –ë—É—Å—Ç –∞–∫—Ç–∏–≤–µ–Ω: ${state.boostActive ? '–î–∞' : '–ù–µ—Ç'}\n`;
      content += `üëÜ –í—Å–µ–≥–æ –∫–ª–∏–∫–æ–≤: ${state.totalClicks.toLocaleString('ru-RU')}\n`;
      content += `üî• –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–º–±–æ: ${state.maxCombo}\n`;
      content += `‚è±Ô∏è  –í—Ä–µ–º—è –∏–≥—Ä—ã: ${minutes}:${seconds.toString().padStart(2, '0')}\n`;
      content += `üí™ –°–∏–ª–∞ –∫–ª–∏–∫–∞: ${getPointsPerClick()} –æ—á–∫–æ–≤\n`;
      content += `ü§ñ –ê–≤—Ç–æ–∫–ª–∏–∫: ${getAutoClickRate()} –æ—á–∫–æ–≤/—Å–µ–∫\n\n`;
      content += `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n`;
      content += `         –î–û–°–¢–ò–ñ–ï–ù–ò–Ø\n`;
      content += `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n`;
      ACHIEVEMENTS.forEach(ach => {
        const unlocked = state.unlockedAchievements.has(ach.id);
        content += `${unlocked ? '‚úÖ' : '‚ùå'} ${ach.emoji} ${ach.title} (${ach.points} –æ—á–∫–æ–≤)\n`;
      });
      content += `\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n`;
      content += `         –£–õ–£–ß–®–ï–ù–ò–Ø\n`;
      content += `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n`;
      UPGRADES.forEach(upgrade => {
        const level = state.upgrades[upgrade.id] || 0;
        content += `${upgrade.emoji} ${upgrade.name}: –£—Ä–æ–≤–µ–Ω—å ${level}\n`;
      });
      content += `\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n`;
      content += `    –°–ø–∞—Å–∏–±–æ –∑–∞ –∏–≥—Ä—É! üêæ\n`;
      content += `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n`;

      try {
        const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –∏—Å–ø–æ–ª—å–∑—É–µ–º replace —Å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º –≤–º–µ—Å—Ç–æ replaceAll
        const filename = `–∫–ª–∏–∫–µ—Ä_–æ—Ç—á—ë—Ç_${state.playerName.replace(/ /g, '_')}.txt`;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:", e);
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –æ—Ç—á—ë—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.");
      }
    }

    // === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ===
    function init() {
      loadGameState();
      updateUI();
      renderLeaderboard();
      startAutoClicker();
      updatePlayTime();

      if (!state.playerName) {
        setTimeout(askForName, 300);
      }
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±—É—Å—Ç–∞
      if (state.boostActive && state.boostEndTime && Date.now() < state.boostEndTime) {
        boostIndicator.classList.remove('hidden');
        capybaraBtn.style.filter = 'brightness(1.2) drop-shadow(0 0 20px #60a5fa)';
        startBoostTimer();
      } else if (state.boostActive) {
        // –ë—É—Å—Ç –∏—Å—Ç–µ–∫, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º
        state.boostActive = false;
        state.boostEndTime = 0;
        saveGameState();
      }

      // –°–æ–±—ã—Ç–∏—è
      capybaraBtn.addEventListener('click', handleClick);
      boostBtn.addEventListener('click', activateBoost);
      exportBtn.addEventListener('click', exportToTxt);

      // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
      setInterval(() => {
        saveGameState();
        saveToLeaderboard();
      }, 5000);

      // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      window.addEventListener('beforeunload', () => {
        saveGameState();
        saveToLeaderboard();
      });
    }

    // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
    init();
  </script>
</body>
</html>
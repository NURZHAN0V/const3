<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ö–ª–∏–∫–µ—Ä —Å –ö–∞–ø–∏–±–∞—Ä–æ–π üêæ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          keyframes: {
            pulseBoost: { 
              '0%,100%': { opacity: 1, boxShadow: '0 0 20px #60a5fa' }, 
              '50%': { opacity: 0.8, boxShadow: '0 0 40px #3b82f6' } 
            },
            float: { 
              '0%,100%': { transform: 'translateY(0)' }, 
              '50%': { transform: 'translateY(-8px)' } 
            }
          },
          animation: {
            pulseBoost: 'pulseBoost 1s infinite',
            float: 'float 3s ease-in-out infinite'
          }
        }
      }
    }
  </script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      overflow-x: hidden;
    }
    .capybara-btn {
      border-radius: 50%;
      object-fit: contain;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      transition: transform 0.15s ease;
      cursor: pointer;
      user-select: none;
      -webkit-user-drag: none;
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-sky-500 via-emerald-500 to-teal-600 p-4 pt-6 text-white">

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —Å–µ—Ç–∫–æ–π: –∏–≥—Ä–∞ + —Ç–æ–ø -->
  <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6">
    
    <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å: –∏–≥—Ä–∞ -->
    <div class="lg:col-span-2">
      <div class="max-w-md mx-auto text-center">
        <div id="greeting" class="mb-3 text-xl font-semibold"></div>
        <div class="mb-6">
          <div id="score" class="text-5xl md:text-6xl font-black bg-clip-text text-transparent bg-gradient-to-r from-amber-300 to-orange-500">
            0
          </div>
          <div id="boostIndicator" class="mt-2 h-1.5 w-48 mx-auto rounded-full bg-white/30 hidden">
            <div id="boostBar" class="h-full rounded-full bg-cyan-300 w-0 transition-all duration-100"></div>
          </div>
        </div>

        <div class="relative flex justify-center mb-6">
          <img 
            id="capybaraBtn"
            src="https://static.vecteezy.com/system/resources/previews/057/531/498/large_2x/a-detailed-image-of-a-capybara-shows-its-fur-and-features-isolated-on-transparent-background-free-png.png"
            alt="–ö–ª–∏–∫–∞–π –ø–æ –∫–∞–ø–∏–±–∞—Ä–µ!"
            class="capybara-btn w-32 h-32 animate-float"
          />
        </div>

        <div class="flex flex-col sm:flex-row gap-3 mb-6">
          <button id="boostBtn"
            class="flex-1 py-3 px-4 bg-gradient-to-r from-amber-500 to-orange-600 text-white font-semibold rounded-xl shadow-md opacity-60 cursor-not-allowed text-sm">
            –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ë—É—Å—Ç (x2) ‚Äî 50 –æ—á–∫–æ–≤
          </button>

          <button id="exportBtn"
            class="flex-1 py-3 px-4 bg-white/20 hover:bg-white/30 text-white font-medium rounded-xl transition">
            üì• –°–∫–∞—á–∞—Ç—å –æ—Ç—á—ë—Ç
          </button>
        </div>

        <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-5 border border-white/20">
          <h3 class="text-xl font-bold mb-3">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
          <div id="achievements" class="grid grid-cols-2 sm:grid-cols-3 gap-3 text-xs sm:text-sm"></div>
        </div>
      </div>
    </div>

    <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å: –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤ -->
    <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-5 border border-white/20 h-fit">
      <h3 class="text-xl font-bold mb-4 text-center">üèÖ –¢–æ–ø-5 –∏–≥—Ä–æ–∫–æ–≤</h3>
      <div id="leaderboard" class="space-y-3">
        <!-- –¢–æ–ø –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
      </div>
      <p class="text-xs text-white/60 mt-4 text-center">–¢–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</p>
    </div>
  </div>

  <script>
    const DATA_KEY = "capybaraClickerData";
    const LEADERBOARD_KEY = "capybaraLeaderboard";

    const ACHIEVEMENTS = [
      { id: '10', points: 10, title: "–ü–µ—Ä–≤—ã–π –∫–ª–∏–∫", emoji: "üêæ" },
      { id: '25', points: 25, title: "–î—Ä—É–≥ –∫–∞–ø–∏–±–∞—Ä", emoji: "ü¶ù" },
      { id: '50', points: 50, title: "–ë—É—Å—Ç-–º–µ–π—Å—Ç–µ—Ä", emoji: "‚ö°" },
      { id: '100', points: 100, title: "–ö–∞–ø–∏–±–∞-–ª–µ–≥–µ–Ω–¥–∞", emoji: "üëë" },
      { id: '200', points: 200, title: "–¶–∞—Ä—å –±–æ–ª–æ—Ç–∞", emoji: "üåø" }
    ];

    const SIZES = [64, 80, 96, 112, 128, 144];

    let state = {
      playerName: "",
      score: 0,
      boostActive: false,
      boostEndTime: 0,
      unlockedAchievements: new Set()
    };

    // DOM
    const greetingEl = document.getElementById('greeting');
    const scoreEl = document.getElementById('score');
    const capybaraBtn = document.getElementById('capybaraBtn');
    const boostBtn = document.getElementById('boostBtn');
    const exportBtn = document.getElementById('exportBtn');
    const boostIndicator = document.getElementById('boostIndicator');
    const boostBar = document.getElementById('boostBar');
    const achievementsEl = document.getElementById('achievements');
    const leaderboardEl = document.getElementById('leaderboard');

    // === –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ ===
    function saveGameState() {
      try {
        localStorage.setItem(DATA_KEY, JSON.stringify({
          playerName: state.playerName,
          score: state.score,
          boostActive: state.boostActive,
          boostEndTime: state.boostEndTime,
          unlockedAchievements: [...state.unlockedAchievements]
        }));
      } catch (e) { console.warn(e); }
    }

    function loadGameState() {
      try {
        const data = JSON.parse(localStorage.getItem(DATA_KEY) || '{}');
        state.playerName = data.playerName || "";
        state.score = data.score || 0;
        state.boostActive = data.boostActive || false;
        state.boostEndTime = data.boostEndTime || 0;
        state.unlockedAchievements = new Set(data.unlockedAchievements || []);
      } catch (e) { console.warn("Load error:", e); }
    }

    function getLeaderboard() {
      try {
        return JSON.parse(localStorage.getItem(LEADERBOARD_KEY) || '[]');
      } catch (e) {
        return [];
      }
    }

    function saveToLeaderboard() {
      const leaderboard = getLeaderboard();
      const existing = leaderboard.find(item => item.name === state.playerName);
      
      if (existing) {
        if (state.score > existing.score) {
          existing.score = state.score;
          existing.date = new Date().toISOString();
        }
      } else {
        leaderboard.push({
          name: state.playerName,
          score: state.score,
          date: new Date().toISOString()
        });
      }

      // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é –∏ –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ø-5
      leaderboard.sort((a, b) => b.score - a.score);
      const top5 = leaderboard.slice(0, 5);
      localStorage.setItem(LEADERBOARD_KEY, JSON.stringify(top5));
      renderLeaderboard();
    }

    function renderLeaderboard() {
      const leaderboard = getLeaderboard();
      leaderboardEl.innerHTML = '';
      
      if (leaderboard.length === 0) {
        leaderboardEl.innerHTML = '<p class="text-center text-white/70">–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∫–æ—Ä–¥–æ–≤</p>';
        return;
      }

      leaderboard.forEach((item, index) => {
        const isCurrent = item.name === state.playerName;
        const medal = ['ü•á', 'ü•à', 'ü•â', '4Ô∏è‚É£', '5Ô∏è‚É£'][index] || 'üèÜ';
        const div = document.createElement('div');
        div.className = `p-3 rounded-lg flex justify-between items-center ${
          isCurrent ? 'bg-amber-500/20 border border-amber-400/50' : 'bg-white/10'
        }`;
        div.innerHTML = `
          <div class="font-medium">${medal} ${item.name}</div>
          <div class="font-bold text-amber-300">${item.score}</div>
        `;
        leaderboardEl.appendChild(div);
      });
    }

    // === –ò–º—è –∏–≥—Ä–æ–∫–∞ ===
    function askForName() {
      if (state.playerName) return;
      let name = prompt("üëã –ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?", "–ò–≥—Ä–æ–∫");
      if (!name || name.trim() === "") name = "–ê–Ω–æ–Ω–∏–º";
      state.playerName = name.trim();
      saveGameState();
      updateUI();
      renderLeaderboard();
    }

    // === UI ===
    function updateUI() {
      greetingEl.textContent = state.playerName ? `–ü—Ä–∏–≤–µ—Ç, ${state.playerName}!` : "";
      scoreEl.textContent = state.score;

      const sizeIndex = Math.min(Math.floor(state.score / 25), SIZES.length - 1);
      const size = SIZES[sizeIndex];
      capybaraBtn.style.width = `${size}px`;
      capybaraBtn.style.height = `${size}px`;

      // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
      achievementsEl.innerHTML = '';
      ACHIEVEMENTS.forEach(ach => {
        const unlocked = state.unlockedAchievements.has(ach.id);
        const el = document.createElement('div');
        el.className = `p-2 rounded-lg ${unlocked ? 'bg-amber-500/20 border border-amber-400/50' : 'bg-white/10'}`;
        el.innerHTML = `
          <div class="text-lg">${unlocked ? ach.emoji : 'üîí'}</div>
          <div class="font-medium mt-1">${ach.title}</div>
          <div class="opacity-80 mt-1">${unlocked ? '‚úÖ' : ach.points}</div>
        `;
        achievementsEl.appendChild(el);
      });

      // –ë—É—Å—Ç
      const canBoost = state.score >= 50 && !state.boostActive;
      boostBtn.disabled = !canBoost;
      boostBtn.className = `flex-1 py-3 px-4 text-white font-semibold rounded-xl shadow-md text-sm ${
        canBoost 
          ? 'bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-400 hover:to-orange-500 cursor-pointer opacity-100' 
          : 'bg-gradient-to-r from-amber-500 to-orange-600 opacity-60 cursor-not-allowed'
      }`;
    }

    // === –ë—É—Å—Ç ===
    function activateBoost() {
      if (state.score < 50 || state.boostActive) return;
      state.score -= 50;
      state.boostActive = true;
      state.boostEndTime = Date.now() + 10000;
      boostIndicator.classList.remove('hidden');
      boostBar.style.width = '100%';
      capybaraBtn.style.boxShadow = '0 0 20px #60a5fa';
      updateUI();
      startBoostTimer();
    }

    function startBoostTimer() {
      const tick = () => {
        const now = Date.now();
        if (now >= state.boostEndTime) {
          state.boostActive = false;
          boostIndicator.classList.add('hidden');
          capybaraBtn.style.boxShadow = '0 8px 20px rgba(0,0,0,0.2)';
          updateUI();
          return;
        }
        const progress = (state.boostEndTime - now) / 10000;
        boostBar.style.width = `${progress * 100}%`;
        setTimeout(tick, 100);
      };
      tick();
    }

    // === –ö–ª–∏–∫ ===
    function handleClick() {
      capybaraBtn.style.transform = 'scale(0.94)';
      setTimeout(() => capybaraBtn.style.transform = '', 100);

      const add = state.boostActive ? 2 : 1;
      state.score += add;

      ACHIEVEMENTS.forEach(ach => {
        if (state.score >= ach.points && !state.unlockedAchievements.has(ach.id)) {
          state.unlockedAchievements.add(ach.id);
        }
      });

      updateUI();
      saveGameState();
      saveToLeaderboard(); // –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ø –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–∫–∞ (–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ä–µ–∂–µ)
    }

    // === –≠–∫—Å–ø–æ—Ä—Ç ===
    function exportToTxt() {
      const date = new Date().toLocaleString('ru-RU');
      let content = `–û—Ç—á—ë—Ç –∏–≥—Ä–æ–∫–∞ "${state.playerName}"\n`;
      content += `–î–∞—Ç–∞: ${date}\n`;
      content += `–û—á–∫–∏: ${state.score}\n`;
      content += `–ë—É—Å—Ç –∞–∫—Ç–∏–≤–µ–Ω: ${state.boostActive ? '–î–∞' : '–ù–µ—Ç'}\n\n`;
      content += `–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è:\n`;
      ACHIEVEMENTS.forEach(ach => {
        const unlocked = state.unlockedAchievements.has(ach.id);
        content += `- ${ach.title}: ${unlocked ? '‚úÖ' : '‚ùå'}\n`;
      });
      content += `\n–°–ø–∞—Å–∏–±–æ –∑–∞ –∏–≥—Ä—É! üêæ`;

      const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `–∫–ª–∏–∫–µ—Ä_–æ—Ç—á—ë—Ç_${state.playerName.replaceAll(' ', '_')}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ===
    loadGameState();
    updateUI();
    renderLeaderboard();

    if (!state.playerName) {
      setTimeout(askForName, 300);
    }
    if (state.boostActive) startBoostTimer();

    capybaraBtn.addEventListener('click', handleClick);
    boostBtn.addEventListener('click', activateBoost);
    exportBtn.addEventListener('click', exportToTxt);
  </script>
</body>
</html>